
# rTechManager - Infrastructure Bootstrap

# 1. INSTALL DEPENDENCIES (One-line command as requested)
sudo apt-get update && sudo apt-get install -y curl build-essential python3-pip tightvncserver websockify libvirt-daemon-system libvirt-clients qemu-kvm iproute2 libpam0g-dev && curl -fsSL https://deb.nodesource.com/setup_22.x | sudo -E bash - && sudo apt-get install -y nodejs

# 2. APP PREPARATION
npm install
npm run build

# 3. CREATE SYSTEMD SERVICE (Standard multi-line format)
sudo tee /etc/systemd/system/rtechmanager.service <<EOF
[Unit]
Description=rTechManager Infrastructure Console
After=network.target libvirtd.service

[Service]
Type=simple
User=root
WorkingDirectory=$(pwd)
ExecStart=/usr/bin/node server.js
Restart=always
Environment=NODE_ENV=production

[Install]
WantedBy=multi-user.target
EOF

# 4. ACTIVATE SERVICE
sudo systemctl daemon-reload
sudo systemctl enable rtechmanager
sudo systemctl restart rtechmanager

echo "rTechManager is now LIVE at http://$(hostname -I | awk '{print $1}'):1783"
